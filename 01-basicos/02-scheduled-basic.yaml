# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# WORKFLOW: Scheduled Trigger BÃ¡sico
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# DescripciÃ³n: Workflow con programaciÃ³n automÃ¡tica usando cron
# Caso de uso: Tareas periÃ³dicas, chequeos regulares, reporting
# Requisitos: Elastic 9.3+
# Autor: IvÃ¡n FrÃ­as Molina - Byviz Analytics
# URL: https://byviz.ai/workflows
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

name: scheduled-basic
description: |
  Workflow con trigger scheduled que se ejecuta automÃ¡ticamente.
  
  Este workflow se ejecuta cada hora y:
  1. Busca documentos creados en la Ãºltima hora
  2. Cuenta cuÃ¡ntos hay
  3. Registra el resultado en consola
  
  Perfecto para entender programaciÃ³n con cron.
  
enabled: true
tags: ["basico", "scheduled", "automatico"]

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# TRIGGERS
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Scheduled: Se ejecuta automÃ¡ticamente segÃºn el schedule
triggers:
  - type: scheduled
    with:
      # Ejecutar cada hora (minuto 0 de cada hora)
      # Sintaxis cron: minute hour day month weekday
      schedule: "0 * * * *"
      
      # Ejemplos de otros schedules:
      # "*/5 * * * *"    â†’ Cada 5 minutos
      # "0 0 * * *"      â†’ Diario a medianoche
      # "0 9 * * MON"    â†’ Lunes a las 9am
      # "0 0 * * 0"      â†’ Domingos a medianoche
      # "0 8-18 * * 1-5" â†’ Cada hora entre 8am-6pm, lunes a viernes

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# STEPS
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
steps:
  # Step 1: Buscar documentos de la Ãºltima hora
  - name: buscar_documentos_recientes
    type: elasticsearch.search
    with:
      index: "logs-*"
      
      # Query con filtro de tiempo
      query:
        bool:
          filter:
            - range:
                "@timestamp":
                  # Ãšltimos 60 minutos
                  gte: "now-1h"
                  lte: "now"
      
      # Solo necesitamos el conteo
      size: 0
      
      # Agregar por nivel de log
      aggregations:
        por_nivel:
          terms:
            field: "log.level"
            size: 10

  # Step 2: Registrar estadÃ­sticas
  - name: mostrar_estadisticas
    type: console
    with:
      message: |
        ğŸ“Š Reporte Horario - {{now | date: "%Y-%m-%d %H:%M"}}
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        Total documentos (Ãºltima hora): {{steps.buscar_documentos_recientes.output.hits.total.value}}
        
        Desglose por nivel:
        {% for bucket in steps.buscar_documentos_recientes.output.aggregations.por_nivel.buckets %}
        - {{bucket.key}}: {{bucket.doc_count}}
        {% endfor %}
        
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        PrÃ³xima ejecuciÃ³n: En 1 hora

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# CÃ“MO USAR ESTE WORKFLOW
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# 1. Copia este YAML en Kibana â†’ Stack Management â†’ Workflows
# 2. Ajusta el Ã­ndice y campos segÃºn tu entorno
# 3. Modifica el schedule segÃºn tus necesidades
# 4. Guarda con enabled: true para activar
# 5. El workflow se ejecutarÃ¡ automÃ¡ticamente
#
# ğŸ“ TESTING:
# - Para probar, cambia el schedule a "*/5 * * * *" (cada 5 minutos)
# - O ejecuta manualmente cambiando trigger a "manual"
# - Revisa el historial de ejecuciones para ver todas las corridas
#
# âš ï¸ IMPORTANTE:
# - No uses schedules muy frecuentes (< 1 minuto) en producciÃ³n
# - Considera el impacto en el cluster
# - Usa enabled: false para pausar sin eliminar el workflow
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

