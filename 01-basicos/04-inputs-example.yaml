# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# WORKFLOW: Ejemplo de Inputs
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# DescripciÃ³n: Workflow parametrizable con inputs dinÃ¡micos
# Caso de uso: Workflows reutilizables con diferentes valores
# Requisitos: Elastic 9.3+
# Autor: IvÃ¡n FrÃ­as Molina - Byviz Analytics
# URL: https://byviz.ai/workflows
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

name: inputs-example
description: |
  Workflow que demuestra el uso de INPUTS para parametrizar la ejecuciÃ³n.
  
  Los inputs permiten:
  - Reutilizar el mismo workflow con diferentes valores
  - Hacer workflows mÃ¡s flexibles y adaptables
  - Solicitar parÃ¡metros en tiempo de ejecuciÃ³n
  
  Este workflow busca logs segÃºn los parÃ¡metros que le pases.
  
enabled: true
tags: ["basico", "inputs", "parametros"]

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# INPUTS
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Los inputs son parÃ¡metros que puedes configurar en cada ejecuciÃ³n
inputs:
  # Input 1: PatrÃ³n de Ã­ndice
  - name: index_pattern
    type: string
    description: "PatrÃ³n de Ã­ndice a buscar"
    required: true
    default: "logs-*"
  
  # Input 2: Nivel de log
  - name: log_level
    type: string
    description: "Nivel de log a filtrar (ERROR, WARN, INFO, DEBUG)"
    required: false
    default: "ERROR"
  
  # Input 3: Rango de tiempo
  - name: time_range
    type: string
    description: "Rango de tiempo (formato Elasticsearch, ej: now-1h)"
    required: false
    default: "now-1h"
  
  # Input 4: NÃºmero de resultados
  - name: max_results
    type: integer
    description: "NÃºmero mÃ¡ximo de documentos a retornar"
    required: false
    default: 10

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# TRIGGERS
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
triggers:
  - type: manual

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# STEPS
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
steps:
  # Step 1: Mostrar parÃ¡metros recibidos
  - name: mostrar_parametros
    type: console
    with:
      message: |
        ğŸ“¥ PARÃMETROS RECIBIDOS
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        Ãndice: {{inputs.index_pattern}}
        Nivel de log: {{inputs.log_level}}
        Rango de tiempo: {{inputs.time_range}}
        MÃ¡ximo de resultados: {{inputs.max_results}}
        
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  # Step 2: Buscar usando los inputs
  - name: buscar_con_parametros
    type: elasticsearch.search
    with:
      # Usar el input index_pattern
      index: "{{inputs.index_pattern}}"
      
      query:
        bool:
          must:
            # Filtrar por nivel de log (usando input)
            - match:
                log.level: "{{inputs.log_level}}"
          
          filter:
            # Filtrar por rango de tiempo (usando input)
            - range:
                "@timestamp":
                  gte: "{{inputs.time_range}}"
                  lte: "now"
      
      # Usar el input max_results
      size: "{{inputs.max_results}}"
      
      sort:
        - "@timestamp":
            order: desc

  # Step 3: Mostrar resultados
  - name: mostrar_resultados
    type: console
    with:
      message: |
        ğŸ“Š RESULTADOS DE LA BÃšSQUEDA
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        Ãndice buscado: {{inputs.index_pattern}}
        Filtro aplicado: log.level = {{inputs.log_level}}
        Periodo: {{inputs.time_range}} hasta now
        
        Total encontrados: {{steps.buscar_con_parametros.output.hits.total.value}}
        Documentos retornados: {{steps.buscar_con_parametros.output.hits.hits.size}}
        Tiempo de bÃºsqueda: {{steps.buscar_con_parametros.output.took}}ms
        
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        ğŸ’¡ PRIMEROS RESULTADOS:
        {% for hit in steps.buscar_con_parametros.output.hits.hits limit:3 %}
        
        [{{loop.index}}] Timestamp: {{hit._source.@timestamp}}
            Mensaje: {{hit._source.message}}
        {% endfor %}

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# CÃ“MO USAR ESTE WORKFLOW CON INPUTS
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# 
# 1. EJECUCIÃ“N MANUAL CON VALORES POR DEFECTO:
#    - Ve a Kibana â†’ Workflows â†’ alert-trigger-basico
#    - Clic en "Execute"
#    - Los valores por defecto se usarÃ¡n automÃ¡ticamente
#
# 2. EJECUCIÃ“N MANUAL CON VALORES PERSONALIZADOS:
#    - Clic en "Execute"
#    - En el modal, cambia los valores de los inputs:
#      * index_pattern: "logs-app-production-*"
#      * log_level: "WARN"
#      * time_range: "now-24h"
#      * max_results: 50
#    - Clic en "Execute"
#
# 3. USO EN WORKFLOWS PROGRAMADOS:
#    - Cuando uses trigger scheduled, los defaults se aplicarÃ¡n
#    - Si necesitas valores distintos, cÃ¡mbialos en la secciÃ³n inputs
#
# ğŸ“ EJEMPLOS DE VALORES:
#
# index_pattern:
#   - "logs-*"                  â†’ Todos los logs
#   - "logs-app-*"              â†’ Logs de aplicaciÃ³n
#   - "logs-prod-*"             â†’ Logs de producciÃ³n
#   - "metrics-*"               â†’ MÃ©tricas
#
# log_level:
#   - "ERROR"    â†’ Solo errores
#   - "WARN"     â†’ Warnings
#   - "INFO"     â†’ InformaciÃ³n
#   - "DEBUG"    â†’ Debug (cuidado con el volumen)
#
# time_range:
#   - "now-15m"  â†’ Ãšltimos 15 minutos
#   - "now-1h"   â†’ Ãšltima hora
#   - "now-24h"  â†’ Ãšltimo dÃ­a
#   - "now-7d"   â†’ Ãšltima semana
#
# max_results:
#   - 10    â†’ Para quick checks
#   - 50    â†’ Para anÃ¡lisis medio
#   - 100   â†’ Para anÃ¡lisis detallado
#   - 1000  â†’ Para exports (cuidado con performance)
#
# ğŸ’¡ VENTAJAS DE USAR INPUTS:
# - Un solo workflow sirve para mÃºltiples escenarios
# - FÃ¡cil de reutilizar sin duplicar cÃ³digo
# - Testing rÃ¡pido con diferentes parÃ¡metros
# - Workflows mÃ¡s mantenibles
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

