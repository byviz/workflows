# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# WORKFLOW: IntegraciÃ³n con Webhook GenÃ©rico
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
name: webhook-integration
description: EnvÃ­a datos a webhook HTTP externo
enabled: true
tags: ["webhook", "http", "integracion"]

consts:
  webhook_url: "https://example.com/webhook"

triggers:
  - type: alert

steps:
  - name: preparar_datos
    type: elasticsearch.search
    with:
      index: "logs-*"
      query:
        bool:
          must:
            - match:
                log.level: "ERROR"
          filter:
            - range:
                "@timestamp":
                  gte: "now-10m"
      size: 10
  
  - name: enviar_webhook
    type: console
    with:
      message: |
        ğŸŒ ENVÃO A WEBHOOK (simulado)
        
        URL: {{consts.webhook_url}}
        Method: POST
        
        Payload:
        {
          "event": "high_error_rate",
          "timestamp": "{{now}}",
          "errors": {{steps.preparar_datos.output.hits.total.value}},
          "severity": "high"
        }
        
        En producciÃ³n, usar:
        - name: enviar_webhook_real
          type: http.request
          with:
            url: "{{consts.webhook_url}}"
            method: POST
            headers:
              Content-Type: "application/json"
              Authorization: "Bearer {{secrets.webhook_token}}"
            body:
              event: "high_error_rate"
              errors: "{{steps.preparar_datos.output.hits.total.value}}"
              timestamp: "{{now}}"

