# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# WORKFLOW: Notificaciones a Microsoft Teams
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
name: teams-notification
description: EnvÃ­a notificaciones enriquecidas a Microsoft Teams
enabled: true
tags: ["teams", "microsoft", "notificacion"]

consts:
  teams_webhook: "https://outlook.office.com/webhook/YOUR_WEBHOOK"

triggers:
  - type: alert

steps:
  - name: recopilar_info
    type: elasticsearch.search
    with:
      index: "logs-*"
      query:
        bool:
          must:
            - match:
                log.level: "ERROR"
          filter:
            - range:
                "@timestamp":
                  gte: "now-10m"
      size: 5
  
  - name: enviar_teams
    type: console
    with:
      message: |
        ğŸ’¬ MICROSOFT TEAMS (simulado)
        
        Adaptive Card payload:
        {
          "@type": "MessageCard",
          "themeColor": "FF0000",
          "title": "ğŸš¨ High Error Rate Alert",
          "text": "{{steps.recopilar_info.output.hits.total.value}} errors detected",
          "sections": [
            {
              "facts": [
                {"name": "Severity", "value": "High"},
                {"name": "Time", "value": "{{now | date: '%H:%M'}}"},
                {"name": "Errors", "value": "{{steps.recopilar_info.output.hits.total.value}}"}
              ]
            }
          ],
          "potentialAction": [
            {
              "@type": "OpenUri",
              "name": "View in Kibana",
              "targets": [{"os": "default", "uri": "https://kibana.example.com"}]
            }
          ]
        }

