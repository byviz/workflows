# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# WORKFLOW: Snapshot AutomÃ¡tico
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
name: snapshot-backup
description: Crea snapshots automÃ¡ticos de Ã­ndices crÃ­ticos
enabled: true
tags: ["backup", "snapshot", "disaster-recovery"]

consts:
  repository: "my_backup_repo"
  indices_to_backup: "logs-critical-*,metrics-*"

triggers:
  - type: scheduled
    with:
      every: "1d"  # Diario (cada 24 horas)

steps:
  - name: verificar_indices
    type: elasticsearch.search
    with:
      index: "{{consts.indices_to_backup}}"
      query:
        match_all: {}
      size: 0
  
  - name: reporte_backup
    type: console
    with:
      message: |
        ğŸ’¾ BACKUP PROGRAMADO
        
        Repositorio: {{consts.repository}}
        Ãndices: {{consts.indices_to_backup}}
        Total docs: {{steps.verificar_indices.output.hits.total.value}}
        Timestamp: {{now | date: "%Y-%m-%d %H:%M"}}
        
        âš ï¸ Para crear snapshots reales:
        
        1. Configurar snapshot repository:
        PUT /_snapshot/{{consts.repository}}
        {
          "type": "fs",
          "settings": {
            "location": "/mount/backups"
          }
        }
        
        2. Crear snapshot:
        PUT /_snapshot/{{consts.repository}}/snapshot-{{now | date: "%Y%m%d"}}
        {
          "indices": "{{consts.indices_to_backup}}",
          "ignore_unavailable": true,
          "include_global_state": false
        }

