# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# WORKFLOW: Resumen Semanal Ejecutivo
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
name: weekly-summary
description: Resumen semanal con comparativas y tendencias
enabled: true
tags: ["reporting", "weekly", "executive"]

triggers:
  - type: scheduled
    with:
      every: "7d"  # Semanal (cada 7 dÃ­as)

steps:
  - name: metricas_semana
    type: elasticsearch.search
    with:
      index: "logs-*,metrics-*"
      query:
        range:
          "@timestamp":
            gte: "now-7d"
      size: 0
      aggregations:
        logs_por_dia:
          date_histogram:
            field: "@timestamp"
            fixed_interval: "1d"
        errores_por_dia:
          date_histogram:
            field: "@timestamp"
            fixed_interval: "1d"
            aggregations:
              solo_errores:
                filter:
                  term:
                    log.level: "ERROR"
  
  - name: reporte_semanal
    type: console
    with:
      message: |
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        ğŸ“… RESUMEN SEMANAL - Semana del {{now | date: "%Y-%m-%d"}}
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        Total logs (7 dÃ­as): {{steps.metricas_semana.output.hits.total.value}}
        
        ğŸ“Š Tendencia diaria:
        {% for bucket in steps.metricas_semana.output.aggregations.logs_por_dia.buckets %}
        {{bucket.key_as_string | date: "%a %d"}}: {{bucket.doc_count}} logs
        {% endfor %}
        
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

