# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# WORKFLOW: AnÃ¡lisis de Series Temporales
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
name: time-series-analysis
description: AnÃ¡lisis de tendencias temporales con date_histogram
enabled: true
tags: ["time-series", "timeline", "tendencias"]

consts:
  index: "logs-*"
  time_range: "7d"

triggers:
  - type: manual

steps:
  - name: timeline_errores
    type: elasticsearch.search
    with:
      index: "{{consts.index}}"
      query:
        bool:
          must:
            - match:
                log.level: "ERROR"
          filter:
            - range:
                "@timestamp":
                  gte: "now-{{consts.time_range}}"
      size: 0
      aggregations:
        errores_por_hora:
          date_histogram:
            field: "@timestamp"
            fixed_interval: "1h"
            extended_bounds:
              min: "now-{{consts.time_range}}"
              max: "now"
          aggregations:
            por_servicio:
              terms:
                field: "service.name"
                size: 5
  
  - name: reporte
    type: console
    with:
      message: |
        ğŸ“ˆ ANÃLISIS TEMPORAL (Ãºltimos {{consts.time_range}})
        
        Timeline de errores por hora (Ãºltimas 24h):
        {% for bucket in steps.timeline_errores.output.aggregations.errores_por_hora.buckets %}
        {{bucket.key_as_string}}: {{bucket.doc_count}} errores
        {% endfor %}

