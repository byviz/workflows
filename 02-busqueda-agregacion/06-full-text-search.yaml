# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# WORKFLOW: BÃºsqueda Full-Text Avanzada
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
name: full-text-search
description: BÃºsqueda full-text con match, phrase, fuzzy y boosting
enabled: true
tags: ["fulltext", "search", "relevancia"]

inputs:
  - name: search_query
    type: string
    default: "connection timeout"
    required: false

triggers:
  - type: manual

steps:
  # Match phrase: frase exacta
  - name: match_phrase
    type: elasticsearch.search
    with:
      index: "logs-*"
      query:
        match_phrase:
          message: "{{inputs.search_query}}"
      size: 10
  
  # Fuzzy: tolera typos
  - name: fuzzy_search
    type: elasticsearch.search
    with:
      index: "logs-*"
      query:
        fuzzy:
          message:
            value: "{{inputs.search_query}}"
            fuzziness: "AUTO"
      size: 10
  
  # Multi-match con boosting
  - name: boosted_search
    type: elasticsearch.search
    with:
      index: "logs-*"
      query:
        multi_match:
          query: "{{inputs.search_query}}"
          fields:
            - "message^3"
            - "error.message^2"
            - "log.logger"
          type: "best_fields"
      size: 10
  
  - name: reporte
    type: console
    with:
      message: |
        ğŸ” BÃšSQUEDA FULL-TEXT: "{{inputs.search_query}}"
        
        Match Phrase: {{steps.match_phrase.output.hits.total.value}} resultados
        Fuzzy Search: {{steps.fuzzy_search.output.hits.total.value}} resultados
        Boosted Search: {{steps.boosted_search.output.hits.total.value}} resultados
        
        Top 3 resultados con boost:
        {% for hit in steps.boosted_search.output.hits.hits %}
        [{{loop.index}}] Score: {{hit._score}}
            {{hit._source.message | truncate: 150}}
        {% endfor %}

