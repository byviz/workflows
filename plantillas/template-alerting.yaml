# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# PLANTILLA: Workflow de Alerting
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# DescripciÃ³n: Template base para workflows de alerting
# Uso: Copiar y personalizar segÃºn necesidades
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

name: template-alerting
description: |
  Plantilla base para workflows de alerting.
  
  Personaliza:
  1. Cambiar name y description
  2. Ajustar consts segÃºn tus umbrales
  3. Modificar query segÃºn tus Ã­ndices
  4. Personalizar acciones (notificaciones, tickets, etc.)
  
enabled: false  # Activar despuÃ©s de personalizar
tags: ["template", "alerting"]

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# CONSTANTES - Ajustar segÃºn tu entorno
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
consts:
  index: "logs-*"                    # Ãndice a monitorear
  threshold: 100                     # Umbral de alerta
  time_window: "10m"                 # Ventana de tiempo
  alert_channel: "#alerts"           # Canal de notificaciÃ³n

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# TRIGGER - Cambiar segÃºn necesidad
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
triggers:
  - type: manual  # Cambiar a 'alert' o 'scheduled' segÃºn caso

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# STEPS
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
steps:
  # Step 1: Detectar condiciÃ³n de alerta
  - name: detectar_problema
    type: elasticsearch.search
    with:
      index: "{{consts.index}}"
      
      # âš ï¸ PERSONALIZAR esta query segÃºn tu caso
      query:
        bool:
          must:
            - match:
                log.level: "ERROR"  # Cambiar campo y valor
          filter:
            - range:
                "@timestamp":
                  gte: "now-{{consts.time_window}}"
      
      size: 10
      
      # Agregar para mÃ¡s contexto
      aggregations:
        por_servicio:
          terms:
            field: "service.name"
            size: 10
  
  # Step 2: Evaluar severidad
  - name: evaluar_severidad
    type: if
    with:
      condition: "{{steps.detectar_problema.output.hits.total.value >= consts.threshold}}"
      then:
        - type: console
          with:
            message: "âš ï¸ Umbral superado: {{steps.detectar_problema.output.hits.total.value}}"
      else:
        - type: console
          with:
            message: "âœ… Dentro de umbrales normales"
  
  # Step 3: Generar contexto
  - name: generar_contexto
    type: console
    with:
      message: |
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        ğŸš¨ ALERTA
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        Timestamp: {{now | date: "%Y-%m-%d %H:%M:%S"}}
        Total: {{steps.detectar_problema.output.hits.total.value}}
        Umbral: {{consts.threshold}}
        Ventana: {{consts.time_window}}
        
        Top servicios afectados:
        {% for bucket in steps.detectar_problema.output.aggregations.por_servicio.buckets %}
        - {{bucket.key}}: {{bucket.doc_count}}
        {% endfor %}
        
        Primeros eventos:
        {% for hit in steps.detectar_problema.output.hits.hits %}
        - [{{hit._source.@timestamp}}] {{hit._source.message | truncate: 100}}
        {% endfor %}
        
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  # Step 4: Acciones (personalizar segÃºn necesidad)
  - name: ejecutar_acciones
    type: console
    with:
      message: |
        ğŸ’¡ ACCIONES A IMPLEMENTAR:
        
        Notificaciones:
        - [ ] Slack/Teams al canal {{consts.alert_channel}}
        - [ ] Email al equipo responsable
        - [ ] PagerDuty si es crÃ­tico
        
        Tickets:
        - [ ] Crear ticket en Jira/ServiceNow
        - [ ] Asignar segÃºn severidad y servicio
        
        RemediaciÃ³n:
        - [ ] Ejecutar health checks
        - [ ] Trigger runbooks automÃ¡ticos
        - [ ] Escalar si persiste

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# CHECKLIST DE PERSONALIZACIÃ“N
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# 
# [ ] Cambiar name a nombre descriptivo
# [ ] Actualizar description
# [ ] Ajustar consts (Ã­ndice, umbrales, etc.)
# [ ] Modificar query segÃºn campos reales
# [ ] Personalizar agregaciones
# [ ] Implementar notificaciones reales
# [ ] Configurar triggers (alert, scheduled)
# [ ] Testear con datos reales
# [ ] Ajustar enabled: true
# [ ] Documentar caso de uso especÃ­fico
# 
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

