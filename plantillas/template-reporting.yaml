# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# PLANTILLA: Workflow de Reporting
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
name: template-reporting
description: Template base para reportes automÃ¡ticos
enabled: false
tags: ["template", "reporting"]

consts:
  index: "logs-*,metrics-*"
  report_range: "24h"
  report_recipient: "team@empresa.com"

triggers:
  - type: scheduled
    with:
      schedule: "0 8 * * *"  # Diario a las 8am - personalizar

steps:
  # 1. Recopilar datos
  - name: recopilar_metricas
    type: elasticsearch.search
    with:
      index: "{{consts.index}}"
      query:
        range:
          "@timestamp":
            gte: "now-{{consts.report_range}}"
      size: 0
      aggregations:
        # âš ï¸ PERSONALIZAR agregaciones
        total_logs:
          value_count:
            field: "@timestamp"
        por_nivel:
          terms:
            field: "log.level"
            size: 10
  
  # 2. Calcular KPIs
  - name: calcular_kpis
    type: console
    with:
      message: |
        ğŸ“Š Calculando KPIs...
        Total: {{steps.recopilar_metricas.output.aggregations.total_logs.value}}
  
  # 3. Generar reporte
  - name: generar_reporte
    type: console
    with:
      message: |
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        ğŸ“Š REPORTE - {{now | date: "%Y-%m-%d"}}
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        Periodo: Ãšltimas {{consts.report_range}}
        
        MÃ‰TRICAS CLAVE:
        Total logs: {{steps.recopilar_metricas.output.aggregations.total_logs.value}}
        
        Por nivel:
        {% for bucket in steps.recopilar_metricas.output.aggregations.por_nivel.buckets %}
        - {{bucket.key}}: {{bucket.doc_count}}
        {% endfor %}
        
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        ğŸ’¡ Personalizar:
        - AÃ±adir mÃ¡s mÃ©tricas
        - Calcular comparativas (hoy vs ayer)
        - Incluir grÃ¡ficos/visualizaciones
        - Enviar por email con email.send

